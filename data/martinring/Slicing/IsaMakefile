## configurables

SESSION-NAME = Slicing
BASE-IMAGE = Jinja

## targets


default: $(SESSION-NAME)
test: $(SESSION-NAME)
images: $(SESSION-NAME)

all: test


## global settings

SRC = $(ISABELLE_HOME)/src
OUT = $(ISABELLE_OUTPUT)
LOG = $(OUT)/log

IMAGE=$(OUT)/$(BASE-IMAGE)

USEDIR = $(ISABELLE_TOOL) usedir -v true -i true -V outline=/proof,/ML -d pdf -g true

# time limit (in sec)
MAXTIME = 5400


## dependencies

# test run and proof document
$(SESSION-NAME): $(OUT)/$(SESSION-NAME)

$(OUT)/$(SESSION-NAME): Jinja $(LOG)/$(SESSION-NAME).gz

Jinja:
	cd ../Jinja; $(ISABELLE_TOOL) make Jinja


$(LOG)/$(SESSION-NAME).gz: $(IMAGE) ROOT.ML Slicing.thy \
  Basic/*.thy Dynamic/*.thy StaticIntra/*.thy While/*.thy JinjaVM/*.thy \
  document/root.tex
	ulimit -t $(MAXTIME); $(USEDIR) -b $(IMAGE) $(SESSION-NAME)


## clean

clean:
	@rm -f $(LOG)/$(SESSION-NAME).gz
	@rm -f $(OUT)/$(SESSION-NAME)
