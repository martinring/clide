## configurables

SESSION-NAME = Huffman
BASE-IMAGE = HOL

## targets

default: $(SESSION-NAME)
test: $(SESSION-NAME)
# usually empty:
images:  

all: images test


## global settings

SRC = $(ISABELLE_HOME)/src
OUT = $(ISABELLE_OUTPUT)
LOG = $(OUT)/log

# turn image into absolute path according to ISABELLE_IMAGE_PATH or OUT
ifeq ($(ISABELLE_IMAGE_PATH),)
IMAGE=$(OUT)/$(BASE-IMAGE)
else
IMAGE=$(ISABELLE_IMAGE_PATH)$(BASE-IMAGE)
endif


USEDIR = $(ISABELLE_TOOL) usedir -v true -i true -d false -P "http://isabelle.in.tum.de/library/" -D generated
FIXDOC = fixdoc
DOCUMENT = $(ISABELLE_TOOL) document -o pdf
DOCUMENT_OUTLINE = $(ISABELLE_TOOL) document -n outline -o pdf -t "/proof,/ML"

# time limit (in sec)
MAXTIME = 3600


## dependencies

$(SESSION-NAME): $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz

$(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz: $(IMAGE) ROOT.ML Huffman.thy document/root.tex 
	(cd ..; ulimit -t $(MAXTIME); $(USEDIR) $(IMAGE) $(SESSION-NAME))
	./$(FIXDOC)
	$(DOCUMENT) generated > /dev/null
	mv document.pdf $(ISABELLE_BROWSER_INFO)/$(BASE-IMAGE)/$(SESSION-NAME)
	$(DOCUMENT_OUTLINE) generated > /dev/null
	mv outline.pdf $(ISABELLE_BROWSER_INFO)/$(BASE-IMAGE)/$(SESSION-NAME)


## clean

clean:
	@rm -f $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz
	@rm -rf generated

